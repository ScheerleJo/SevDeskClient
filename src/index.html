<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="/main.js" defer></script>
    <script src="https://kit.fontawesome.com/97ecc9f9f9.js" crossorigin="anonymous"></script>
    <title>SevDesk - Generierte Spendenbescheinigungen</title>
</head>
<body onload="loadData()">    
    <!--NAVBAR / HEAD-->
    <div class="head">
        <nav data-tauri-drag-region class="navbar" id="head">
            <ul class="nav-list" id="ul-home">
                <!-- <li class="nav-item" id="titlebar-home"><a href="#" onclick="setStartStatus()"><i class="fa-solid fa-house"></i></a></li> -->
                <li class=" nav-item" id="titlebar-settings">
                    <a><i class="fa-solid fa-gear"></i> Einstellungen</a>
                    <ul class="dropdown-list">
                        <li><a onclick="showSetAuthToken()"><i class="fa-solid fa-key"></i> Authorisierungs-Token</a></li>
                        <li><a onclick="showSetConnection()"> <i class="fa-solid fa-network-wired"></i> Server-verbindung</a></li>
                        <!-- <li><a href="#"><i id="server-status" class="fa-solid fa-power-off"></i> Server starten/stoppen</a></li> -->
                        <!-- <li><a href="#"><i class="fa-solid fa-file"></i> Standard .tex Vorlage</a></li> -->
                    </ul> 
                </li>  
                <!-- <li class="nav-item" id="titlebar-help"><a href="#">Hilfe <i class="fa-solid fa-question"></i></a></li> -->
                <li class="nav-item nav-button "><button onclick="saveCurrentState()">Aktuellen Stand speichern</button></li>
            </ul>
        </nav>
    </div>
    <div class="body-wrapper">
        <div class="container"id="status-container" style="display: none;">
                <div class="inline" id="status-content">
                    
                </div>
                <a class="inline" href="#" onclick="hideElement('status-container')" id="close-status"><i class="fa-solid fa-x"></i></a>
        </div>
        <div class="container">
            <!-- <p class="second-line">Willkommen bei der automatsierten Erstellung von Spendenbescheinigungen der Theologischen Fernschule e.V.</p> -->
            <div>
                <p class="inline">Jahr auswählen:</p>
                <input class="inline" type="number" name="year" id="input-year" placeholder="Jahr eingeben">
            </div>
        </div>
        <table id="autocreate-table">
            <thead>
                <tr>
                    <th><span>Mehr</span></th>
                    <th><span>Status</span></th>

                    <th><span>Nachname</span></th>
                    <th><span>Vorname(n)</span></th>
                    <th><span>Adresse</span></th>
                    <th><span>Anzahl</span> <span>Spenden</span></th>

                    <th><span>Summe</span></th>
                    <th><span>In Worten</span></th>
                    <th><span>Geprüft</span></th>
                    <th>Bescheinigung erstellen</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="autocreate-table-body">
            </tbody>
        </table>
        <div class="button-wrapper">
            <button onclick="fetchNewData()">Daten neu abfragen</button>
            <button onclick="downloadTex()">Test</button>
            <button id="move-button" class="table-button" onclick="createLatexFile()">Bescheinigungen erstellen</button>

        </div>
    </div>
    <footer>
        <p>Anwendung entwickelt von Josia Scheerle. Bei Fragen oder Problemen gerne an <a id="link-mail" href="mailto:coding@scheerlestudios.de">coding@scheerlestudios.de</a> oder Tel.: +49 176 56927561</p>
    </footer>
</body>

<script>

// import { exists, BaseDirectory, createDir, createFile, writeFile, readFile } from '@tauri-apps/api/fs';
// async function createConfigFile() {
//   // let path = await BaseDirectory.Download + '/config.json';
//     let content = { 'server': 'http://' + connection }
//   // await writeTextFile(path, JSON.stringify(content), { dir: BaseDirectory.Download });
//     await createDir('users', { dir: BaseDirectory.Download, recursive: false });
// }

function downloadTex() {
    fetch('http://localhost:8040/getLatex').then(response => {
        return response.blob();
    }).then(blob => {
        const url = window.URL.createObjectURL(new Blob([blob]));
        const a = document.createElement('a');
        a.href = url;
        a.download = 'test.tex';
        a.click();
    });
}


</script>


<script src="main.js">
    loadData();
</script>
<p style="display: none;" id="server-connection">http://localhost:8040</p>
<p style="display: none;" id="donatorData-storage"></p>
</html>